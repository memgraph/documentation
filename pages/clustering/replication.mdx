---
title: Replication
description: Dive into the documentation page for Memgraph and learn how to configure replication for data redundancy and disaster recovery. Examine the power of replication for enhanced data reliability.
---

import { Callout } from 'nextra/components'

# How to setup replication with Memgraph (Community)

<Callout type="info">

This guide is for **Memgraph Community** users who want to set up data replication across multiple instances.
If you have a **Memgraph Enterprise** license, we recommend using the [high availability features](/clustering/high-availability) instead, which provide automatic failover, 
load balancing, and comprehensive cluster management capabilities.

</Callout>

<Callout>

**Users are advised to first read the guide on [how replication works](/clustering/concepts/how-replication-works).**

</Callout>

## Data replication implementation basics

In Memgraph, all instances are MAIN upon starting. When creating a replication
cluster, one instance has to be chosen as the MAIN instance. The rest of the
instances have to be demoted to REPLICA roles and have a port defined using a
Cypher query.

The MAIN instance can accept read and write queries, while the REPLICA instance can only accept
reads. Once an instance has been demoted to a REPLICA instance, it will no longer accept write queries.
In order to start the replication, each REPLICA instance needs to be registered
from the MAIN instance by setting a [replication mode](/clustering/concepts/how-replication-works#replication-modes)
(SYNC, ASYNC or STRICT_SYNC) and specifying the REPLICA instance's socket address.

Once the REPLICA instances are registered, data storage of the MAIN instance is
replicated and synchronized using transaction timestamps and durability files
(snapshot files and WALs). When we talk about data storage, we strictly mean the graph
itself, along with the complementary performance and correctness data structures, such as nodes, 
relationships, properties, indices, constraints, triggers, and streams.
For replication support of non-graph data, such as authentication configurations, multi-tenant data, please refer 
to the [system replication reference](/clustering/replication/system-replication).

By using the timestamp, the MAIN instance knows the current state of the
REPLICA. If the REPLICA is not synchronized with the MAIN instance, the MAIN
instance sends the correct data for synchronization kept as delta objects within WAL
files. Deltas are the smallest possible updates of the database, but they carry
enough information to synchronize the data on a REPLICA. For more information about delta objects,
please refer to the [in-memory transactional storage mode guides](/fundamentals/storage-memory-usage#in-memory-analytical-storage-mode).

If the REPLICA is so far behind the MAIN instance that the synchronization using
WAL files and deltas within it is impossible, Memgraph will use snapshots to
synchronize the REPLICA to the state of the MAIN instance.

From Memgraph version 2.15, a REPLICA instance has integrated support to only
listen to one MAIN. This part is introduced to support the high availability but
also reflects on the replication. The mechanism that is used is a unique
identifier that which MAIN instance sends to all REPLICAs when REPLICA is first
registered on a MAIN. A REPLICA stores the UUID of the MAIN instance it listens
to. The MAIN's UUID is also stored on a disk, in case of restart of an instance
to continue listening to the correct MAIN instance.

<Callout type="info">

As of Memgraph v3.5 replication queries (such as `REGISTER REPLICA`, `SHOW
REPLICAS`, `DROP REPLICA`, etc.) target the default "memgraph" database and
require access to it. The recommendation is to use the default "memgraph"
database as an admin/system database and store graphs under other databases. 

</Callout>

### Requirements for replication queries

To execute replication queries, users must have:
1. The `REPLICATION` privilege
2. **AND** access to the default "memgraph" database

### Impact on multi-tenant environments

In multi-tenant environments where users might not have access to the "memgraph"
database, replication management operations will fail. This reinforces the
recommendation to treat the "memgraph" database as an administrative/system
database.

{<h4 className="custom-header">Example: Admin user with replication privileges</h4>}

```cypher
-- Create admin role with replication privileges
CREATE ROLE replication_admin;
GRANT REPLICATION TO replication_admin;
GRANT DATABASE memgraph TO replication_admin;

-- Create user with replication admin role
CREATE USER repl_admin IDENTIFIED BY 'admin_password';
SET ROLE FOR repl_admin TO replication_admin;
```

In this setup, `repl_admin` can:
- Execute all replication queries (`REGISTER REPLICA`, `SHOW REPLICAS`, etc.)
- Access the "memgraph" database for administrative operations
- Manage the replication cluster configuration


## Running multiple instances

When running multiple instances, each on its own machine, run Memgraph as you
usually would.

If you are exploring replication and running multiple instances on one machine,
you can run Memgraph with Docker, but if you are using volumes, they need to be
called differently and each instance needs to be exposed via a different port.

Check the example of creating [a replication
cluster](/clustering/replication/setup-replication-cluster-docker).

## Assigning roles

Each Memgraph instance has the role of the MAIN instance when it is first
started.

Also, by default, each crashed instance restarts with its previous role (MAIN as
MAIN, REPLICA as REPLICA). To change this behavior, set the
`--replication-restore-state-on-startup` to `false` when first initializing the
instance. In this way, all instances will get restarted as MAIN.

### Assigning the REPLICA role

Once you decide what instance will be the MAIN instance, all the other instances
that will serve as REPLICA instances need to be demoted and have the port set
using the following query:

```plaintext
SET REPLICATION ROLE TO REPLICA WITH PORT <port_number>;
```

If you set the port of each REPLICA instance to `10000`, it will be easier to
register replicas later on because the query for registering replicas uses a
port 10000 as the default one.

Otherwise, you can use any unassigned port between 1000 and 10000.

### Assigning the MAIN role

The replication cluster should only have one MAIN instance in order to avoid
errors in the replication system. If the original MAIN instance fails, you can
promote a REPLICA instance to be the new MAIN instance by running the following
query:

```plaintext
SET REPLICATION ROLE TO MAIN;
```

If the original instance was still alive when you promoted a new MAIN, you need
to resolve any conflicts and manage replication manually.

If you demote the new MAIN instance back to the REPLICA role, it will not
retrieve its original function. You need to [drop
it](#dropping-a-replica-instance) from the MAIN and register it again.

If the crashed MAIN instance goes back online once a new MAIN is already
assigned, it cannot reclaim its previous role. It can be cleaned and demoted to
become a REPLICA instance of the new MAIN instance.

### Checking the assigned role

To check the replication role of an instance, run the following query:

```plaintext
SHOW REPLICATION ROLE;
```

## Registering REPLICA instances

Once all the nodes in the cluster are assigned with appropriate roles, you can
enable replication in the MAIN instance by registering REPLICA instances,
setting a replication mode (SYNC and ASYNC), and specifying the REPLICA
instance's socket address. Memgraph doesn't support chaining REPLICA instances,
that is, a REPLICA instance cannot be replicated on another REPLICA instance.

If you want to register a REPLICA instance with a SYNC replication mode, run the
following query:

```plaintext
REGISTER REPLICA name SYNC TO <socket_address>;
```

If you want to register a REPLICA instance with an ASYNC replication mode, run
the following query:

```plaintext
REGISTER REPLICA name ASYNC TO <socket_address>;
```


If you want to register a REPLICA instance with an STRICT_SYNC replication mode,
run the following query:

```plaintext
REGISTER REPLICA name STRICT_SYNC TO <socket_address>;
```

The socket address must be a string value as follows:

```plaintext
"IP_ADDRESS:PORT_NUMBER"
```

where `IP_ADDRESS` is a valid IP address, and `PORT_NUMBER` is a valid port
number, for example:

```plaintext
"172.17.0.4:10050"
```

The default value of the `PORT_NUMBER` is `10000`, so if you set REPLICA roles
using that port, you can define the socket address specifying only the valid IP
address:

```plaintext
"IP_ADDRESS"
```

Example of a `<socket_address>` using only `IP_ADDRESS`:

```plaintext
"172.17.0.5"
```

Also, you can register REPLICA instances using DNS names. In that case, the
socket address must be a string value as follows:

```plaintext
"DOMAIN_NAME:PORT_NUMBER"
```

where `DOMAIN_NAME` is a valid domain name, and `PORT_NUMBER` is a valid port
number, for example:

```plaintext
"memgraph-replica.memgraph.net:10050"
```

If you set REPLICA roles using port `10000`, you can define the socket address
specifying only the valid domain name, for example:

```plaintext
"memgraph-replica.memgraph.net"
```

When a REPLICA instance is registered, it will start replication in ASYNC mode
until it synchronizes to the current state of the database. Upon
synchronization, REPLICA instances will either continue working in the ASYNC,
STRICT_SYNC or SYNC mode.

### Listing all registered REPLICA instances

You can check all the registered REPLICA instances and their details by running
the following query:

```plaintext
SHOW REPLICAS;
```

### Dropping a REPLICA instance

To drop a replica, run the following query:

```plaintext
DROP REPLICA <name>;
```
