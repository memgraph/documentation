---
title: Manage Memgraph with Docker
description: Learn how to manage your Memgraph instance in the Docker environment.
---

import { Card, Cards } from 'nextra/components'

# Manage Memgraph with Docker 

Learn the best practices for managing your Memgraph instance in the Docker
environment.

## Install and run Memgraph with Docker

Memgraph offers two images you can run with Docker, depending on your needs:

- `memgraph/memgraph-mage` - use this image if you require [MAGE
  library](/advanced-algorithms) which consist of graph algorithms and util
  procedures. 
- `memgraph/memgraph` - use this image if you just require Memgraph database
  without MAGE library. This image is more lightweight but it does not include
  commonly used graph algorthms.

In this guide we'll proceed with `memgraph/memgraph-mage` images for all examples,
but if you'd like to use `memgraph/memgraph` image, just replace it in the code
snippets.

The simplest way of running Memgraph in the Docker environment is using the
following command:

```
docker run -p 7687:7687 -p 7444:7444 memgraph/memgraph-mage
```

Once started, you'll see Memgraph logs in the terminal. To avoid logs showing up
in the terminal, you can run the container in detach mode (`-d` flag).

The above command starts Memgraph in a Docker container and it exposes ports
`7687` and `7444`. The port `7687` is used to connect to databse and query it via Bolt
protocol. The port `7444` is optional, but it's a good practice to use it, because
that's where the logs are exposed. Memgraph Lab, visual user interface, uses
that port to note all logs in the UI. 

To connect to Memgraph, you can use CLI [mgconsole](/cli), preferred
[client](/client-libraries) or visual user interface [Memgraph
Lab](/data-visualization).

## Configure Memgraph

Memgraph has its configuration settings persisted in the `memgraph.conf` file
located in the `/etc/memgraph` folder. Some of the most commonly configured
settings are:

- `--log-level=WARNING`
- `--query-execution-timeout-sec=600`
- `--storage-snapshot-interval-sec=300	`
- `--storage-snapshot-retention-count=3`
- `--storage-mode=IN_MEMORY_TRANSACTIONAL`

Of course, other
[settings](/configuration/configuration-settings#list-of-configuration-settings)
are as important, so make sure you get familiar with them as well.

To configure Memgraph within the `docker run` command, add the appropriate flags
at the end of the command. For example, to change log level to `TRACE` and to
remove query execution timeout, run the following command:

```
docker run -p 7687:7687 -p 7444:7444 memgraph/memgraph-mage --log-level=TRACE --query-execution-timeout-sec=0
```

The set flags override the default settings in the `memgraph.conf` file. It is
also possible to provide additional configuration file by providing path to it
via `--file-flag` or `MEMGRAPH_CONFIG` environment variable. The set values in
that file will override values in the default `memgraph.conf` file. Still, flags
in the `docker run` command will override them both, so be careful how you're
setting the configuration. To ensure all is set correctly, run `SHOW CONFIG`
once the database is up and running.

## Secure the database

- How can I create a user? How can I authenticate? (in Docker env)

### Set up SSL encryption

## Persist data with Docker volumes

Docker volumes are used for data persistence across container lifecycles, data
sharing between containers, efficient data storage, backup and migration and for
easy access from the host system. 

Whenever you restart your Docker container, the container's filesystem will
persist your data, logs and configuration. Still, data will not be persisted
across container deletion and recreation. To ensure you have your data even if
you decide to spin up a new container, run the container with volumes. 

Volumes are the preferred mechanism for persisting data generated by and used by
Docker containers. They are completely managed by Docker and are stored outside
of the default filesystem. The data in volumes is preserved across container
restarts and can be shared between multiple containers.

Although bind mounts, which allow you to attach specific paths from your host
machine to paths in the container, are also used for data persistence, they are
not a recommended option.

The best practice to ensure volume data persistence is to use named volumes and
to do regular backups.

Here is the command to run Memgraph with volumes for data persistency:

```
docker run -p 7687:7687 -p 7444:7444 -v mg_lib:/var/lib/memgraph memgraph/memgraph-mage
```

It is common that you want to ensure you have the same Memgraph configuration
wherever you start it. Then you can add volume for the configuration persistency
as well:

```
docker run -p 7687:7687 -p 7444:7444 -v mg_lib:/var/lib/memgraph -v mg_etc:/etc/memgraph memgraph/memgraph-mage
```

If you'd like an easy access to logs on your machine, you can add volume for logs as well:

```
docker run -p 7687:7687 -p 7444:7444 -v mg_lib:/var/lib/memgraph -v mg_etc:/etc/memgraph -v mg_log:/var/log/memgraph memgraph/memgraph-mage
```

Named volumes are Docker-managed volumes that store data independently of
containers. They are not directly mapped to a specific host directory that you
choose because in this case, Docker manages where the data is stored on the
host. However, you can still access this data from the host.

As opposed to bind mounts, named volumes provide better encapsulation and
separation of environment. Having named volumes makes it easier to back up or
migrate data. Since they're managed by Docker, there is an additional layer of
abstraction and security. Named volumes are more suitable for production
deployments, where security, data integrity, and portability are critical. 


If you want to start a new Memgraph instance with the data from another Docker
container which has `mg_lib` volume attached to it, you can run the following
command:

```
docker run -p 7687:7687 -p 7444:7444 -v mg_lib:/var/lib/memgraph memgraph/memgraph-mage
```

The new container will be started with the contents from the `mg_lib` volume,
meaning it will restore the database from the existing snapshots. That's the
easiest way to transfer your data to another instance.


ADD INFO:
- two containers can't use the same volume at the same time! -- memgraph just exists -> if you plan on using the same volume, stop the running container already using that volume
- two containers can use the same volume if they're not running in the same time - the easiest way to spin up new instance with old data (same goes for config)
- using named volume is the easiest way to migrate date between different containers - to have files locally, just inspect volume and save to local machine (it's quite easy via Docker Desktop) - this can be done even when the container is down
- if volumes were not used, then user needs to c/p snapshots (var/lib/memgraph)

## Backup data

All your data is stored in the `/var/lib/memgraph` folder. Specifically,
snapshots and wal-files folders hold the data necessary to restore the database.
It is a good practice to have a named volume on the `/var/lib/memgraph` folder.
That volume can be attached to a new instance which will then be started with
your data loaded.

Still, it is good to regularly do a backup.


### Copy the data persistence folder 

Simplest approach -> save content from the mg_lib named volume - can be done when container is stopped as well 

The another way to make sure you have your data is to copy the contents of
snapshots and/or wal-files folders to a safe location. To do that, use `docker
cp` command. For example, to copy the whole persistence folder from Memgraph
onto the local file system, first run the following query in Memgraph to lock
the data directory in order to avoid changes happening during the backup process:

```
LOCK DATA DIRECTORY;
```

After that, copy the data persistency folder onto your local file system:

```
docker cp <container_id>:/var/lib/memgraph /path/to/my/local-folder
```

In the end, unlock the data directly by running the following query in Memgraph:

```
UNLOCK DATA DIRECTORY;
```

By default, Memgraph creates snapshots every 300 seconds and retains 3 latest
snapshots, so it can easily recover in case of corruption. It is a good practice
to have more than 1 snapshot. If something caused the database to crash,
Memgraph will still be able to recover your data from the write-ahead logs. On
exit, Memgraph will create the latest snapshot. All of this can be configured,
based on your dataset size and use case. If your data is not being frequently
updated, you can disable periodic snapshot creation and create snapshot manually
when you need to.

### Dump database

1. docker exec -it -u 0 <container_id> bash
2. echo "DUMP DATABASE;" | mgconsole --output-format=cypherl > data.cypherl
3. docker cp <container_id>:data.cypherl data.cypherl

What happens if dataset is too large?


## Restore data

No hassle with file ownership if named volumes are used.

Copy snapshot file into the new container and change ownership. -> how?


or

Import Cypherl (from dumpdb) -> how? -> link to import cypherl and that's it.

### Upgrading Memgraph

What if snapshots changed in between versions? What to do then? How to migrate data properly?

## Set up a cluster

- Instructions on how to set up a replication cluster

### Set up a highly-available cluster [enterprise]

## Logging and monitoring

- How can I check Memgraph logs in Docker env? What is the best practice?
- Can I monitor the db? How? Websocket, HTTP (enterprise)


## Where to next?

Docker is a powerful tool, and it is usually a good starting point. If your
application involves multiple services besides a database, you might want to
create a multi-container application with Docker Compose. To learn more about
how to manage Memgraph in such environment, follow our Docker Compose guide.

To discuss Docker and similar topics, [join our Discord
community](https://www.discord.gg/memgraph).

Schedule a 30-min session with our engineers to discuss how Memgraph fits with
your architecture. Our engineers are highly experienced in helping companies of
all sizes to integrate and get the most out of Memgraph in their projects. Talk
to us about data modeling, optimizing queries, defining infrastructure
requirements or migrating from your existing graph database. No nonsense or
sales pitch, just tech.

![](/pages/getting-started/memgraph-office-hours.svg)

<Cards>
  <Card
    title="Book a call"
    href="https://memgraph.com/office-hours"
  />
</Cards>
