import { Callout } from 'nextra/components'

# Python quick start

## Prerequisites

- A **running Memgraph instance**. If you need to set up Memgraph, take a look
  at the [Installation guide](/getting-started/install-memgraph).
- Python version >= 3.7.

**Don't forget the connection details** since you'll need them to connect to Memgraph with Python client library. 
The connection details are URI (e.g. `bolt://localhost:7687`) and, optionally, username and password (if you [created a user](/configuration/security#creating-users)). 


## Install Python client library

To connect with Memgraph with Python, first install the [Python client library](https://pypi.org/project/neo4j/) with `pip`:
 
```
pip install neo4j
```

The Neo4j Python client library connects to Memgraph using the Bolt protocol. 
 
## Connect to the database

To connect to Memgraph, create a driver object with the appropriate URI and AUTH arguments. 
If you're running Memgraph locally, URI looks something like `bolt://localhost:7687`, and if you are running Memgraph on a remote server, replace `localhost` with the appropriate IP address. 
If you ran Memgraph on port different than 7687, don't forget to update that in the URI too. By default, you can set username and password in the AUTH argument as empty strings. But, if you [created a user](/configuration/security#creating-users) in Memgraph, make sure to provide the correct connection details.

To verify the connection (credentials and versions) you can run the `verify_connectivity()` procedure on the driver object. Be aware that the connection verification can raise a number of different exceptions.


### Connect without authentication
Here is an example of how to connect to Memgraph, that is running locally on port 7687, with the Python client library **without authentication** and how to get node count from the database: 

```python
from neo4j import GraphDatabase

URI = "bolt://localhost:7687"
AUTH = ("", "")

with GraphDatabase.driver(URI, auth=AUTH) as driver:
    driver.verify_connectivity()

    # Count the number of nodes in the database
    records, summary, keys = driver.execute_query(
        "MATCH (n) RETURN count(n) AS num_of_nodes;"
    )

    # Get the result
    for record in records:
        print(record["num_of_nodes"])
```

### Connect with authentication

If you [created a user](/configuration/security#creating-users) in Memgraph, then you need to provide the correct username and password when defining AUTH argument to connect to the database.
Let's say you already created a user with username `user` and password `pass`. Here is an example of how to connect to Memgraph, that is run locally on port 7687, with the Python client library **with authentication** and how to get node count from the database: 

```python
from neo4j import GraphDatabase

URI = "bolt://localhost:7687"
AUTH = ("user", "pass")

with GraphDatabase.driver(URI, auth=AUTH) as driver:
    driver.verify_connectivity()

    # Count the number of nodes in the database
    records, summary, keys = driver.execute_query(
        "MATCH (n) RETURN count(n) AS num_of_nodes;", database_="memgraph"
    )

    # Get the result
    for record in records:
        print(record["num_of_nodes"])
```

<Callout type="info"> 

Note for Docker users

If the program fails to connect to a Memgraph instance that was started with
Docker, you may need to use a different IP address (not the default `localhost`
/ `127.0.0.1` ) to connect to the instance.

You can find the **`CONTAINER_ID`** with `docker ps` and use it in the following
command to retrieve the address:

```
docker inspect -f '{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}' CONTAINER_ID
```

</Callout>

## Query the database

### Multicommand transactions

To query the database, run the `execute_query()` procedure on the driver object with the Cypher query argument, along with its parameters and database name. 
A good practice is to always provide a database name, to avoid extra request to the server and in that way, improve performance and to provide parameters to protect your queries from Cypher injections.
Since v2.10, Memgraph added the [multi-tenant support](/configuration/multi-tenancy) in the Enterprise Edition to manage multiple isolated databases within a single instance. 
Make sure you provide the correct database name if you're working with more than one tenant. 

The `execute_query()` procedure automatically creates a transaction in which you can include multiple Cypher statements in a single query. 

Bolt protocol specifies additional data that can be sent along with the requested results. Such data is called [metadata](/configuration/metadata) and can be divided into two groups: query statistics and notifications.
When running a **write query**, query statistics will be available under the `stats` key of the summary. 

```python
with GraphDatabase.driver(URI, auth=AUTH) as driver:
    # Create a user in the database
    records, summary, keys = driver.execute_query(
        "CREATE (u:User {name: $name, password: $password}) RETURN u.name AS name",
        name="John",
        password="pass",
        database_="memgraph",
    )

    # Get the result
    for record in records:
        print(record["name"])
    
    # Print summary and Memgraph write query statistics
    print(summary.__dict__)
    print(summary.metadata["stats"])
```

**Read queries** can be run in the same way. From their results, you can read the summary, but the query statistics from Memgraph won't be shown, because they refer only to the **changes** done by the query.

```python
with GraphDatabase.driver(URI, auth=AUTH) as driver:
    # Find a user John in the database
    with GraphDatabase.driver(URI, auth=AUTH) as driver:
        records, summary, keys = driver.execute_query(
            "MATCH (u:User {name: $name}) RETURN u.name AS name",
            name="John",
            database_="memgraph",
        )

    # Get the result
    for record in records:
        print(record["name"])
    
    # Print summary
    print(summary.__dict__)
```

<Callout type="warning">

Error with multicommand transactions

`Index manipulation not allowed in multicommand transactions` is a kind of error you might experience. To fix that, use implicit (or auto-commit) transactions instead. 
That is the simplest way to run a Cypher query because implicit transactions won't be automatically retried as with `execute_query()` procedure or managed transactions. 
To create a label-property index on `:User(name)`, run the following code:
```python
with GraphDatabase.driver(URI, auth=AUTH).session(database="memgraph") as session:
    session.run("CREATE INDEX ON :User(name);")
```
</Callout>


#### Managed transactions


### Implicit transactions


