---
title: Migrate from Memgraph Platform to Memgraph MAGE
description: Switch from legacy version of Memgraph Platform to Memgraph MAGE.
---

import { Card, Cards } from 'nextra/components'
import { Callout } from 'nextra/components'
import { Steps } from 'nextra/components'

# Migrate from Memgraph Platform to Memgraph MAGE

Memgraph Platform was deployed as a single Docker image until version 2.15.
Starting with version 2.15, the platform has transitioned to a multi-container
application. This upgrade separates the previous single Docker image into
individual containers for Memgraph+MAGE and Memgraph Lab.

If you are running an older version of Memgraph Platform (versions up to 2.15),
you can migrate your data to the newer version of Memgraph using one of the
methods described below.

### Using a snapshot

A snapshot in Memgraph is a backup of your database. Once you create a snapshot of your Memgraph Platform you can copy it your fresh Memgraph MAGE instance and restore the data.

### Creating a snapshot

 Here's how you can create one:

 <Steps>

{<h3>Start Memgraph Platform</h3>}

Start your Memgraph Platform using the following command:

```bash
docker run -p 7687:7687 -p 7444:7444 -p 3000:3000 --name mgplatform -e MEMGRAPH="--telemetry-enabled=False --log-level=TRACE" memgraph/memgraph-platform
```

{<h3>Open Memgraph Lab</h3>}

Use your web browser to connect to [http://localhost:3000](http://localhost:3000).

{<h3>Create new snapshot</h3>}

Run the following query:

CREATE SNAPSHOT;

The snapshot is saved in the directory (`/var/lib/memgraph/snapshots`).

In the log file you will see the complete path for the snapshot. the log entry will look something like this:

```
[2024-05-09 13:05:56.453][Debug][Run - memgraph] 'CREATE SNAPSHOT'
[2024-05-09 13:05:56.453][Info]Starting snapshot creation to "/var/lib/memgraph/snapshots/20240509130556453229_timestamp_406"
[2024-05-09 13:05:56.527][Info]Snapshot creation successful!
```


<Callout>
Another way to check the snapshot's full name and path is to run the following command on your host:

```bash
docker exec mgplatform ls -al /var/lib/memgraph/snapshots
```
The output will be similar to this:

```
total 11828
drwxr-xr-x 2 memgraph memgraph    4096 May  9 13:07 .
drwxrwxrwx 1 memgraph memgraph    4096 May  9 13:03 ..
-rw-r----- 1 memgraph memgraph 1101782 May  9 13:04 20240509130415306911_timestamp_162
-rw-r----- 1 memgraph memgraph 5497050 May  9 13:05 20240509130556453229_timestamp_406
-rw-r----- 1 memgraph memgraph 5497050 May  9 13:07 20240509130704295444_timestamp_517
```
</Callout>


{<h3>Stop Memgraph Platform</h3>}


After creating the snapshot, stop the Memgrpah Platform container:

```bash
docker stop mgplatform
```


{<h3>Copy a snapshot to the host</h3>}

Now you need to copy the snapshot file. In this case this copy `20240509130704295444_timestamp_517` from your Docker container to your host using:

```bash
docker cp mgplatform:/var/lib/memgraph/snapshots/20240509130704295444_timestamp_517 /tmp/snapshots/
```

The output will be something like:

```
Successfully copied 5.5MB to /tmp/snapshots/
```


{<h3>Start and stop Memgraph MAGE</h3>}

Start the `mgmage` container using:

```bash
docker run -p 7687:7687 -p 7444:7444 --name mgmage memgraph/memgraph-mage --log-level=TRACE
docker create -p 7687:7687 -p 7444:7444 -v snapshots:/var/lib/memgraph/snapshots --name mgmage memgraph/memgraph-mage --log-level=TRACE
tar -cf - /tmp/snapshots/20240509130704295444_timestamp_517 | docker cp -a - mgmage:/var/lib/memgraph/snapshots
```

To safely copy snapshot file into it, stop the `mgmage` container:
```bash
docker stop mgmage
```


{<h3>Copy snapshot file to `mgmage` Container</h3>}

Copy the snapshot file from `/temp/transfer` to the `mgmage` container:
```bash
docker cp c:\temp\transfer\20240509130704295444_timestamp_517 mgmage:/var/lib/memgraph/snapshots/
```

The output will be something like:
```
Successfully copied 5.5MB to mgmage:/var/lib/memgraph/snapshots/
```

{<h3>Restart the `mgmage` container</h3>}
Finally, start the `mgmage` container again:
```bash
docker start mgmage
```


After running this command, you can connect to the Memgraph instance using the command-line interface `mgconsole` by running the following command in a new terminal:

```bash
docker exec -it mgmage mgconsole
```


docker create -p 7687:7687 -p 7444:7444 -v c:\temp\snapshots\`:/var/lib/memgraph/snapshots --name mgmage memgraph/memgraph-mage --log-level=TRACE

docker start mgmage


tar -cf - .\20240509110709931436_timestamp_148 | docker exec -i mgmage tar -C /var/lib/memgraph/snapshots -xf -



</Steps>

## Dumping the Database

Dumping the database in Memgraph creates a comprehensive record of the database state, encapsulating nodes, relationships, indexes, constraints, and triggers in Cypher queries. 

### Creating a Database Dump

To create a dump of your Memgraph Platform database, execute the following command in `mgconsole` or Memgraph Lab:

```opencypher
DUMP DATABASE;
```

This command will generate a series of Cypher queries that represent the current state of the database. These queries can be used to recreate the database at its dumped state.

### Exporting the Dump File

In Memgraph Lab, navigate to the `Import & Export` section. Here, you can export the database dump to a file with a `.cypherl` extension. This file can be used to import the database state into another instance of Memgraph or for backup purposes.

## Importing a Database Dump

To import a database dump into Memgraph, you will need to execute the Cypher queries contained within the `.cypherl` file. This can be done through `mgconsole` or directly in Memgraph Lab.

1. Ensure your Memgraph instance is running and accessible.
2. Load the Cypher queries from your dump file into `mgconsole` or execute them in Memgraph Lab.

https://memgraph.com/docs/data-migration/cypherl


## Restoring a Snapshot

To restore a snapshot, you can follow these steps:

1. Copy the backed-up snapshot file into the `snapshots` directory after creating the container and start the database. The commands should look like this:
```bash
docker create -p 7687:7687 -p 7444:7444 -v `snapshots`:/var/lib/memgraph/snapshots --name memgraphDB memgraph/memgraph
tar -cf - sample_snapshot_file | docker cp -a - memgraphDB:/var/lib/memgraph/snapshots
```
The `sample_snapshot_file` is the snapshot file you want to use to restore the data. 

2. After that, start the database with:
```bash
docker start -a memgraphDB
```
The `-a` flag is used to attach to the container's output so you can see the logs.

3. Once Memgraph is started, change the snapshot directory ownership to the `memgraph` user by running the following command:
```bash
docker exec -it -u 0 memgraphDB bash -c "chown memgraph:memgraph /var/lib/memgraph/snasphots"
```
Otherwise, Memgraph will not be able to write the future snapshot files and will fail.

For more detailed instructions, you can refer to the [Memgraph documentation](https://memgraph.com/docs/configuration/data-durability-and-backup).